<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üöÄ Rocket Tool ‚Äî Realtime Stock Analyzer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:Inter,system-ui,Arial,sans-serif;background:#f9fafb;margin:0;color:#0f172a}
    .wrap{max-width:900px;margin:20px auto;padding:16px}
    .card{background:#fff;border-radius:14px;padding:20px;box-shadow:0 6px 16px rgba(0,0,0,0.08)}
    header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
    h2{margin:0;font-size:20px}
    select{padding:8px 10px;border-radius:8px;border:1px solid #e2e8f0;background:#fff}
    .metrics{display:flex;gap:12px;margin:14px 0;flex-wrap:wrap}
    .metric{flex:1;min-width:160px;background:#f8fafc;padding:10px;border-radius:10px}
    .metric h3{margin:0;font-size:18px}
    .metric p{margin:6px 0 0;font-size:13px;color:#64748b}
    footer{margin-top:18px;color:#94a3b8;font-size:13px}
    canvas{max-width:100%;margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h2>üöÄ Rocket Tool ‚Äî ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏∏‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ô‡∏ß‡∏£‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡∏ï‡πâ‡∏≤‡∏ô</h2>
        <select id="stockSelect">
          <option value="RBRK">RBRK</option>
          <option value="AAPL">AAPL</option>
          <option value="MSFT">MSFT</option>
          <option value="TSLA">TSLA</option>
          <option value="RKLB">RKLB</option>
          <option value="EOSE">EOSE</option>
          <option value="NAVD">NAVD</option>
          <option value="PLTR">PLTR</option>
        </select>
      </header>

      <div class="metrics">
        <div class="metric">
          <h3 id="price">‚Äî</h3><p>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (USD)</p>
        </div>
        <div class="metric">
          <h3 id="res1">‚Äî</h3><p>‡πÅ‡∏ô‡∏ß‡∏ï‡πâ‡∏≤‡∏ô 1</p>
        </div>
        <div class="metric">
          <h3 id="res2">‚Äî</h3><p>‡πÅ‡∏ô‡∏ß‡∏ï‡πâ‡∏≤‡∏ô 2</p>
        </div>
        <div class="metric">
          <h3 id="sup1">‚Äî</h3><p>‡πÅ‡∏ô‡∏ß‡∏£‡∏±‡∏ö 1</p>
        </div>
        <div class="metric">
          <h3 id="sup2">‚Äî</h3><p>‡πÅ‡∏ô‡∏ß‡∏£‡∏±‡∏ö 2</p>
        </div>
      </div>

      <canvas id="chart" height="240"></canvas>

      <footer>
        ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å <strong>Alpha Vantage API</strong> (‡∏à‡∏≥‡∏Å‡∏±‡∏î 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ô‡∏≤‡∏ó‡∏µ)<br>
        ‡∏´‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà
      </footer>
    </div>
  </div>

  <script>
    const API_KEY = "4F4NRBC1I6SEAE4W";
    const select = document.getElementById("stockSelect");
    const ctx = document.getElementById("chart").getContext("2d");
    let chart;

    async function fetchStockData(symbol) {
      const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${API_KEY}`;
      const res = await fetch(url);
      const data = await res.json();
      const series = data["Time Series (Daily)"];
      if (!series) throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API");
      const dates = Object.keys(series).slice(0, 30).reverse();
      const closes = dates.map(d => parseFloat(series[d]["4. close"]));
      const highs = dates.map(d => parseFloat(series[d]["2. high"]));
      const lows = dates.map(d => parseFloat(series[d]["3. low"]));
      return { dates, closes, highs, lows };
    }

    function calcLevels(highs, lows) {
      const high30 = Math.max(...highs);
      const low30 = Math.min(...lows);
      const avgHigh5 = highs.slice(-5).reduce((a,b)=>a+b,0)/5;
      const avgLow5 = lows.slice(-5).reduce((a,b)=>a+b,0)/5;
      return { res1: avgHigh5, res2: high30, sup1: avgLow5, sup2: low30 };
    }

    function renderChart(dates, closes, levels) {
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: dates,
          datasets: [
            {
              label: "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏¥‡∏î (USD)",
              data: closes,
              borderColor: "#0ea5a4",
              backgroundColor: "rgba(14,165,164,0.15)",
              fill: true,
              tension: 0.25
            },
            {
              label: "‡πÅ‡∏ô‡∏ß‡∏ï‡πâ‡∏≤‡∏ô1",
              data: new Array(dates.length).fill(levels.res1),
              borderColor: "#ef4444",
              borderDash: [5,5],
              fill: false
            },
            {
              label: "‡πÅ‡∏ô‡∏ß‡∏£‡∏±‡∏ö1",
              data: new Array(dates.length).fill(levels.sup1),
              borderColor: "#3b82f6",
              borderDash: [5,5],
              fill: false
            }
          ]
        },
        options: {
          plugins: { legend: { display: true } },
          scales: { x: { display: true }, y: { beginAtZero: false } }
        }
      });
    }

    async function updateStock() {
      const symbol = select.value;
      try {
        const { dates, closes, highs, lows } = await fetchStockData(symbol);
        const price = closes[closes.length - 1];
        const levels = calcLevels(highs, lows);
        document.getElementById("price").textContent = `$${price.toFixed(2)}`;
        document.getElementById("res1").textContent = levels.res1.toFixed(2);
        document.getElementById("res2").textContent = levels.res2.toFixed(2);
        document.getElementById("sup1").textContent = levels.sup1.toFixed(2);
        document.getElementById("sup2").textContent = levels.sup2.toFixed(2);
        renderChart(dates, closes, levels);
      } catch (err) {
        console.error(err);
        alert("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + err.message);
      }
    }

    select.addEventListener("change", updateStock);
    updateStock(); // ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
  </script>
</body>
</html>
